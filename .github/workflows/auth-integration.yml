name: Auth Integration Tests

on:
  push:
    branches: [ main, 'ci/**', 'feat/**', 'fix/**' ]
  pull_request:
    branches: [ main ]

jobs:
  auth-integration:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: false

      - name: Set up Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: 1.75.0
          profile: minimal
          components: rustfmt, clippy

      - name: Install system deps
        run: |
          sudo apt-get update && sudo apt-get install -y libssl-dev pkg-config zlib1g-dev

      - name: Run auth tests (unit + integration)
        run: |
          cargo test -p verseguy_auth --tests -- --nocapture

      - name: Run clippy (workspace scope)
        run: |
          cargo clippy --workspace --all-targets -- -D warnings
